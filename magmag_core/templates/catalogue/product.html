{% extends 'layout.html' %}
{% load i18n %}

{% block extra %}
    <link rel="stylesheet" href="{{ STATIC_URL }}magmag_core/css/flexslider.css" type="text/css" media="screen" />
    <script src="{{ STATIC_URL }}magmag_core/js/jplugins/jquery.flexslider.js" type="text/javascript"></script>
    <script type="text/javascript">


    var items = {
    {% for item in items %}
        {{  item.hash_name }}: { id: {{ item.id }}, product: '{{ product.name }}', image: '{{ product.image.url }}', price: {{ product.price }}, color: '{{ item.color }}', size: '{{ item.size }}' },
    {% endfor %}
    };
    </script>

{% endblock %}

{% block doc_ready %}
        $('.product-size-list li div').click(function(e){
            var inputid = this.id.replace('alt-','#');
            $(inputid).prop("checked","true");
            enable_btnadd();
        });
        $('.product-color-list li div').click(function(e){
            var inputid = this.id.replace('alt-','#');
            $(inputid).prop("checked","true");
            enable_btnadd();
        });

        var enable_btnadd = function(){
            if ($('input[name=size]:checked').length > 0 && $('input[name=color]:checked').length > 0 && $('.btn-add').hasClass('btn-disabled')) {
                $('.btn-add').removeClass('btn-disabled');
                $('.btn-add').click(function(e){
                    var size = $("input:radio[name=size]:checked").val();
                    var color = $("input:radio[name=color]:checked").val();

                    var item = items[color+size];
                    if(typeof(item) !== 'undefined' && item != null && typeof(basket) !== 'undefined' && basket != null)
                    {
                        basket.setPurchaseItem(item.id, item);
                    }
                });
            }
        }

    {% endblock %}

{% block content_wrapper %}
<aside class="image-galery">
    {% if images|length > 1 %}
        <div id="product_slides_{{product.id  }}" class="flexslider">
            <ul class="slides">
            {% for img in images %}
                <li data-thumb="{{ img.thumbnail.url }}">
                    {% if img.preview %}
                            <img src="{{ img.preview.url }}" >
                            {% if img.caption %}
                                <div class="flex-caption">{{ img.caption }}</div>
                            {% endif %}
                    {% elif img.original %}
                        <div><img src="{{ img.original.url }}"/></div>
                    {% endif %}
                </li>
            {% endfor %}
            </ul>
        </div>
        <div id="product_slidesnav_{{product.id  }}" class="flexslider navcarusel">
            <ul class="slides">
            {% for img in images %}
                <li>
                    {% if img.thumbnail %}
                            <img src="{{ img.thumbnail.url }}" >

                    {% elif img.original %}
                        <div><img style="width: 150px; height: 150px;" src="{{ img.original.url }}"/></div>
                    {% endif %}
                </li>
            {% endfor %}
            </ul>
        </div>
        <script>

            $(window).load(function() {

                $('#product_slidesnav_{{product.id  }}').flexslider({
                    animation: "slide",
                    controlNav: false,
                    animationLoop: false,
                    slideshow: false,
                    itemWidth: 150,
                    itemMargin: 5,
                    prevText: '',
                    nextText: '',
                    asNavFor: '#product_slides_{{product.id  }}'
                });

                $('#product_slides_{{product.id  }}').flexslider({
                    animation: "slide",
                    smoothHeight: true,
                    slideshow: false,
                    controlNav: false,
                    prevText: '',
                    nextText: '',
                    sync:'#product_slidesnav_{{product.id  }}'
                });
            });
        </script>
    {% endif %}
</aside>
<section class="product-details">
    <h1 class="product-name">{{ product.name }}</h1>
    <p>{{ product.description }}</p>
    <div>{% trans "Please select size and color and press Add to order " %}</div>
    <div class="color-size-container">
        <div>
            <ul class="product-size-list">
                {% for key, item in sizes.items %}
                <li>
                    <input name="size" type="radio" id="sizeid-{{ key }}" value="{{ key }}" {% if size|length == 1 %} checked="true" {% endif %}/>
                    <div id="alt-sizeid-{{ key }}">
                        <strong>{{ item }}</strong>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div>
            <ul class="product-color-list">
                {% for key, item in colors.items %}
                <li>
                    <input name="color" type="radio" id="colorid-{{ key }}" value="{{ key }}" {% if colors|length == 1 %} checked="true" {% endif %}/>
                    <div id="alt-colorid-{{ key }}">
                        <strong>{{ item }}</strong>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="product-add-to-cart-container">
        <div class="btn btn-disabled btn-add">Add to order</div>
    </div>
</section>
{% endblock %}